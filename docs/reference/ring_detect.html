<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Automatic detection of tree-ring borders — ring_detect • MtreeRing</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Automatic detection of tree-ring borders — ring_detect" />

<meta property="og:description" content="This function is used to automatically detect tree ring 
borders along the user-defined path." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MtreeRing</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/app-MtreeRing.html">A Simple Workflow for Shiny App</a>
    </li>
    <li>
      <a href="../articles/detection-MtreeRing.html">MtreeRing: Measuring Tree Ring Width in R</a>
    </li>
    <li>
      <a href="../articles/pith-MtreeRing.html">Measure Tree Rings on Pith Side</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/JingningShi/MtreeRing">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Automatic detection of tree-ring borders</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/MtreeRing/blob/master/R/ring_detect.R'><code>R/ring_detect.R</code></a></small>
    <div class="hidden name"><code>ring_detect.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This function is used to automatically detect tree ring 
borders along the user-defined path.</p>
    
    </div>

    <pre class="usage"><span class='fu'>ring_detect</span>(<span class='no'>ring.data</span>, <span class='kw'>seg</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>auto.path</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>manual</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"canny"</span>, <span class='kw'>incline</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>sample.yr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>watershed.threshold</span> <span class='kw'>=</span> <span class='st'>"auto"</span>, <span class='kw'>watershed.adjust</span> <span class='kw'>=</span> <span class='fl'>0.8</span>,
  <span class='kw'>struc.ele1</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>struc.ele2</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>marker.correction</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>default.canny</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>canny.t1</span>, <span class='no'>canny.t2</span>, <span class='kw'>canny.smoothing</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>canny.adjust</span> <span class='kw'>=</span> <span class='fl'>1.4</span>, <span class='kw'>path.dis</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>origin</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>border.color</span> <span class='kw'>=</span> <span class='st'>"black"</span>, <span class='kw'>border.type</span> <span class='kw'>=</span> <span class='fl'>16</span>, <span class='kw'>label.color</span> <span class='kw'>=</span> <span class='st'>"black"</span>,
  <span class='kw'>label.cex</span> <span class='kw'>=</span> <span class='fl'>1.2</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ring.data</th>
      <td><p>A magick image object produced by <code><a href='ring_read.html'>ring_read</a></code>.</p></td>
    </tr>
    <tr>
      <th>seg</th>
      <td><p>An integer specifying the number of image segments.</p></td>
    </tr>
    <tr>
      <th>auto.path</th>
      <td><p>A logical value. If <code>TRUE</code>, a path is automatically 
created at the center of the image. If <code>FALSE</code>, the function allows 
the user to create a sub-image and a path by interactive clickings. 
See details below.</p></td>
    </tr>
    <tr>
      <th>manual</th>
      <td><p>A logical value indicating whether to skip the automatic 
detection. If <code>TRUE</code>, ring borders are visually identified after 
creating the path. See <code><a href='ring_modify.html'>ring_modify</a></code> to learn how to mark
tree rings by clicking on the image.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>A character string specifying how ring borders are detected. 
It requires one of the following characters: <code>"watershed"</code>, 
<code>"canny"</code>, or <code>"lineardetect"</code>. See details below.</p></td>
    </tr>
    <tr>
      <th>incline</th>
      <td><p>A logical value indicating whether to correct ring widths. 
If <code>TRUE</code>, two horizontal paths are added to the image.</p></td>
    </tr>
    <tr>
      <th>sample.yr</th>
      <td><p><code>NULL</code> or an integer giving the year of formation 
of the left-most ring. If <code>NULL</code>, use the current year.</p></td>
    </tr>
    <tr>
      <th>watershed.threshold</th>
      <td><p>The threshold used for producing the marker 
image, either a numeric from 0 to 1, or the character "auto" (using the 
Otsu algorithm), or a character of the form "XX%" (e.g., "58%").</p></td>
    </tr>
    <tr>
      <th>watershed.adjust</th>
      <td><p>A numeric used to adjust the Otsu threshold. 
The default is 1 which means that the threshold will not be adjusted. 
The sizes of early-wood regions in the marker image will reduce along 
with the decrease of <code>watershed.adjust</code>.</p></td>
    </tr>
    <tr>
      <th>struc.ele1</th>
      <td><p><code>NULL</code> or a vector of length two specifying the 
width and height of the first structuring element. If <code>NULL</code>, the 
size of the structuring element is determined by the argument <code>dpi</code>.</p></td>
    </tr>
    <tr>
      <th>struc.ele2</th>
      <td><p><code>NULL</code> or a vector of length two specifying the 
width and height of the second structuring element. If <code>NULL</code>, the 
size of the structuring element is determined by the argument <code>dpi</code>.</p></td>
    </tr>
    <tr>
      <th>marker.correction</th>
      <td><p>A logical value indicating whether to relabel 
early-wood regions by comparing the values of their left-side neighbours.</p></td>
    </tr>
    <tr>
      <th>default.canny</th>
      <td><p>A logical value. If <code>TRUE</code>, upper and lower 
Canny thresholds are determined automatically.</p></td>
    </tr>
    <tr>
      <th>canny.t1</th>
      <td><p>A numeric giving the threshold for weak edges.</p></td>
    </tr>
    <tr>
      <th>canny.t2</th>
      <td><p>A numeric giving the threshold for strong edges.</p></td>
    </tr>
    <tr>
      <th>canny.smoothing</th>
      <td><p>An integer specifying the degree of smoothing.</p></td>
    </tr>
    <tr>
      <th>canny.adjust</th>
      <td><p>A numeric used as a sensitivity control factor for 
the Canny edge detector. The default is 1 which means that the sensitivity 
will not be adjusted. The number of detected borders will reduce along 
with the increase of this value.</p></td>
    </tr>
    <tr>
      <th>path.dis</th>
      <td><p>A numeric specifying the perpendicular distance between 
two paths when the argument <code>incline = TRUE</code>. The unit is in mm.</p></td>
    </tr>
    <tr>
      <th>origin</th>
      <td><p>A numeric specifying the origin in smoothed gray to find 
ring borders. See <code>ringBorders</code> from the package 
<code>measuRing</code>.</p></td>
    </tr>
    <tr>
      <th>border.color</th>
      <td><p>Color for ring borders.</p></td>
    </tr>
    <tr>
      <th>border.type</th>
      <td><p>Symbol for ring borders. See <code>pch</code> in 
<code><a href='https://www.rdocumentation.org/packages/graphics/topics/points'>points</a></code> for possible values and their shapes.</p></td>
    </tr>
    <tr>
      <th>label.color</th>
      <td><p>Color for years and border numbers.</p></td>
    </tr>
    <tr>
      <th>label.cex</th>
      <td><p>The magnification to be used for years and border numbers.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix (grayscale image) or array (color image) 
representing the tree-ring image.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If <code>auto.path = FALSE</code>, the user can create a rectangular sub-image 
and a horizontal path by interactively clicking on the tree ring image. 
The automatic detection will be performed within this rectangular 
sub-image. 
To create a sub-image and a path, follow these steps.</p><ul>
<li><p>Step 1. Select the left and right edges of the rectangle</p>  
<p>If <code>partial.rings = TRUE</code>, the user can point the mouse at any 
  desired locations and click the left mouse button to add each edge.</p>  
<p>If <code>partial.rings = FALSE</code>, the left and right boundaries of the 
  original image will be used directly as the left and right edges of 
  the rectangle (i.e., skip the step 1).</p></li>
<li><p>Step 2. Select the top and bottom edges of the rectangle</p>  
<p>The user can point the mouse at any desired locations and click the 
  left mouse button to add each edge. The width of the rectangle is 
  defined as the distance between the top and bottom edges, and should 
  not be unnecessarily large to reduce time consumption and memory usage. 
  Creating a long and narrow rectangle if possible.</p></li>
<li><p>Step 3. Create a path</p>  
<p>After creating the rectangular sub-image, the user can add a horizontal 
  path by left-clicking on the sub-image (generally at the center of the 
  sub-image, try to choose a clean defect-free area). Ring borders and 
  other markers are plotted along this path. If <code>incline = TRUE</code>, 
  two paths are added simultaneously.</p></li>
</ul>
    <p>After creating the sub-image and the path, this function will open several 
graphics windows and plot detected ring borders on image segments. The 
number of image segments is controlled by the argument <code>seg</code>.</p>
<p>Argument <code>method</code> determines how ring borders are identified.</p><ul>
<li><p>If <code>method = "watershed"</code>, this function uses the watershed algorithm 
  to obtain ring borders (Soille and Misson, 2001).</p></li>
<li><p>If <code>method = "canny"</code>, this function uses the Canny algorithm 
  to detect borders.</p></li>
<li><p>If <code>method = "lineardetect"</code>, a linear detection algorithm from the 
  package <code>measuRing</code> is used to identify ring borders (Lara 
  et al., 2015). Note that <code>incline = TRUE</code> is not supported in this 
  mode, and path will be automatically created at the center of the image.</p></li>
</ul><p>If the argument <code>method = "watershed"</code> or <code>"canny"</code>, the original 
image is processed by morphological openings and closings using rectangular 
structuring elements of increasing size before detecting borders. The first 
small structuring element is used to remove smaller dark spots in early 
wood regions, and the second large structuring element is used to remove 
light strips in late wood regions. More details about morphological 
processing can be found at Soille and Misson (2001).</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>This function uses <code><a href='https://www.rdocumentation.org/packages/graphics/topics/locator'>locator</a></code> to record mouse 
positions so it only works on "X11", "windows" and "quartz" devices.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Soille, P., Misson, L. (2001)
Tree ring area measurements using morphological image analysis.
<em>Canadian Journal of Forest Research</em>
<b>31</b>, 1074-1083. doi: 10.1139/cjfr-31-6-1074</p>
<p>Lara, W., Bravo, F., Sierra, C.A. (2015)
measuRing: An R package to measure tree-ring widths from scanned images.
<em>Dendrochronologia</em>
<b>34</b>, 43-50. doi: 10.1016/j.dendro.2015.04.002</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>img.path</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"001.png"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MtreeRing"</span>)

<span class='co'>## Read a tree ring image:</span>
<span class='no'>t1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='ring_read.html'>ring_read</a></span>(<span class='kw'>img</span> <span class='kw'>=</span> <span class='no'>img.path</span>, <span class='kw'>dpi</span> <span class='kw'>=</span> <span class='fl'>1200</span>, <span class='kw'>plot</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'>## Split a long core sample into 3 pieces to</span>
<span class='co'>## get better display performance and use the</span>
<span class='co'>## watershed algorithm to detect ring borders:</span>
<span class='no'>t2</span> <span class='kw'>&lt;-</span> <span class='fu'>ring_detect</span>(<span class='no'>t1</span>, <span class='kw'>seg</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>'watershed'</span>, <span class='kw'>border.color</span> <span class='kw'>=</span> <span class='st'>'green'</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: The sampling year is set to the current year</span></div><div class='output co'>#&gt; <span class='message'>dev.new(): using pdf(file="Rplots9.pdf")</span></div><div class='output co'>#&gt; <span class='message'>dev.new(): using pdf(file="Rplots10.pdf")</span></div><div class='output co'>#&gt; <span class='message'>dev.new(): using pdf(file="Rplots11.pdf")</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Jingning Shi</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jingning Shi, Wei Xiang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

